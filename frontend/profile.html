<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil AyarlarÄ± - Tarif-e</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/profile.css">
    <link rel="stylesheet" href="/static/css/themes.css">

    <script>
        // Token kontrolÃ¼
        if (!localStorage.getItem('access_token')) {
            window.location.href = '/login.html';
        }

        // API Base
        const API_BASE = 'http://localhost:8000';
    </script>
    <script src="/static/js/theme.js" defer></script>
</head>
<body>

<!-- User Info Bar -->
<div id="user-info-bar" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
">
    <div>
        <span id="user-display-name" style="font-weight: 600; font-size: 1.1em;">KullanÄ±cÄ±</span>
    </div>
    <div style="display: flex; gap: 10px; align-items: center;">
        <button onclick="window.location.href='/'"
                style="
                    padding: 8px 16px;
                    background: rgba(255,255,255,0.2);
                    color: white;
                    border: 1px solid rgba(255,255,255,0.3);
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                    transition: all 0.2s;
                "
                onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'">
            ğŸ  Ana Sayfa
        </button>
        <button onclick="logout()"
                style="
                    padding: 8px 16px;
                    background: rgba(255,255,255,0.2);
                    color: white;
                    border: 1px solid rgba(255,255,255,0.3);
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 600;
                    transition: all 0.2s;
                "
                onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'">
            ğŸšª Ã‡Ä±kÄ±ÅŸ
        </button>
    </div>
</div>

<!-- Main Content Spacer -->
<div style="height: 70px;"></div>

<!-- Container -->
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">

    <!-- Profil KartÄ± -->
    <div class="profile-card">
        <div class="profile-photo-section">
            <div class="profile-photo-container">
                <img id="profile-photo-display"
                     src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23E2E8F0'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='40' fill='%234A5568'%3EğŸ‘¤%3C/text%3E%3C/svg%3E"
                     alt="Profil FotoÄŸrafÄ±">
                <div class="photo-overlay">
                    <label for="profile-photo-input" class="photo-upload-btn">
                        ğŸ“· DeÄŸiÅŸtir
                    </label>
                    <input type="file"
                           id="profile-photo-input"
                           accept="image/*"
                           style="display: none;"
                           onchange="uploadProfilePhoto()">
                </div>
            </div>
            <button class="btn btn-secondary" onclick="deleteProfilePhoto()" style="margin-top: 10px;">
                ğŸ—‘ï¸ FotoÄŸrafÄ± Sil
            </button>
        </div>

        <div class="profile-info">
            <h3 id="profile-username">Username</h3>
            <p id="profile-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="67020a060e0b27021f060a170b024904080a">[email&#160;protected]</a></p>
            <p id="profile-joined" style="font-size: 0.85em; color: #A0AEC0; margin-top: 5px;">
                Ãœyelik: -
            </p>
        </div>
    </div>

    <!-- Tab Navigasyon -->
    <div class="settings-tabs">
        <button class="tab-btn active" onclick="showSettingsTab('personal')">
            ğŸ‘¤ KiÅŸisel Bilgiler
        </button>
        <button class="tab-btn" onclick="showSettingsTab('preferences')">
            ğŸ½ï¸ Tercihler
        </button>
        <button class="tab-btn" onclick="showSettingsTab('security')">
            ğŸ”’ GÃ¼venlik
        </button>
        <button class="tab-btn" onclick="showSettingsTab('appearance')">
            ğŸ¨ GÃ¶rÃ¼nÃ¼m
        </button>
    </div>

    <!-- KiÅŸisel Bilgiler Tab -->
    <div id="settings-tab-personal" class="settings-tab-content active">
        <h3>KiÅŸisel Bilgiler</h3>

        <div class="form-group">
            <label>Ad Soyad:</label>
            <input type="text" id="full-name-input" class="input" placeholder="Ad Soyad">
        </div>

        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email-input" class="input" placeholder="email@example.com">
        </div>

        <div class="form-group">
            <label>HakkÄ±mda:</label>
            <textarea id="bio-input" class="input" rows="4" placeholder="Kendiniz hakkÄ±nda birkaÃ§ kelime..."></textarea>
        </div>

        <button class="btn btn-primary" onclick="updateUserInfo()">
            ğŸ’¾ Bilgileri Kaydet
        </button>
    </div>

    <!-- Tercihler Tab -->
    <div id="settings-tab-preferences" class="settings-tab-content">
        <h3>Beslenme Tercihleri</h3>
        <p class="info-text">Bu tercihler tarif Ã¶nerilerinde kullanÄ±lacaktÄ±r</p>

        <!-- Diyet Tercihleri -->
        <div class="preference-section">
            <h4>ğŸ¥— Diyet Tercihleri</h4>
            <div id="dietary-preferences-container" class="preference-grid">
                <!-- JavaScript ile doldurulacak -->
            </div>
        </div>

        <!-- Alerjiler -->
        <div class="preference-section">
            <h4>âš ï¸ Alerjilerim</h4>
            <div id="allergies-container" class="preference-grid">
                <!-- JavaScript ile doldurulacak -->
            </div>
        </div>

        <!-- SevmediÄŸim Yiyecekler -->
        <div class="preference-section">
            <h4>âŒ SevmediÄŸim Yiyecekler</h4>
            <div class="form-group">
                <input type="text"
                       id="dislike-input"
                       class="input"
                       placeholder="Ã–rn: patlÄ±can, kereviz"
                       onkeypress="if(event.key === 'Enter') addDislike()">
                <button class="btn btn-secondary" onclick="addDislike()">
                    â• Ekle
                </button>
            </div>
            <div id="dislikes-list" class="tags-list">
                <!-- JavaScript ile doldurulacak -->
            </div>
        </div>

        <button class="btn btn-success" onclick="savePreferences()">
            ğŸ’¾ Tercihleri Kaydet
        </button>
    </div>

    <!-- GÃ¼venlik Tab -->
    <div id="settings-tab-security" class="settings-tab-content">
        <h3>Åifre DeÄŸiÅŸtir</h3>

        <div class="form-group">
            <label>Mevcut Åifre:</label>
            <input type="password" id="current-password" class="input" placeholder="Mevcut ÅŸifreniz">
        </div>

        <div class="form-group">
            <label>Yeni Åifre:</label>
            <input type="password" id="new-password" class="input" placeholder="Yeni ÅŸifre (en az 6 karakter)">
        </div>

        <div class="form-group">
            <label>Yeni Åifre (Tekrar):</label>
            <input type="password" id="confirm-password" class="input" placeholder="Yeni ÅŸifrenizi tekrar girin">
        </div>

        <button class="btn btn-primary" onclick="changePassword()">
            ğŸ”’ Åifreyi DeÄŸiÅŸtir
        </button>

        <div class="security-tips" style="margin-top: 30px; padding: 15px; background: #FFF8E1; border-radius: 8px;">
            <h4>ğŸ›¡ï¸ GÃ¼venlik Ä°puÃ§larÄ±:</h4>
            <ul style="margin: 10px 0 0 20px; color: #666;">
                <li>Åifreniz en az 6 karakter olmalÄ±</li>
                <li>BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf, rakam ve Ã¶zel karakter kullanÄ±n</li>
                <li>AynÄ± ÅŸifreyi farklÄ± sitelerde kullanmayÄ±n</li>
                <li>Åifrenizi kimseyle paylaÅŸmayÄ±n</li>
            </ul>
        </div>
    </div>

    <!-- GÃ¶rÃ¼nÃ¼m Tab -->
    <div id="settings-tab-appearance" class="settings-tab-content">
        <h3>GÃ¶rÃ¼nÃ¼m AyarlarÄ±</h3>

        <div class="preference-section">
            <h4>ğŸ¨ Tema SeÃ§imi</h4>
            <p class="info-text">UygulamanÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ deÄŸiÅŸtir</p>

            <div class="theme-options">
                <div class="theme-option" data-theme="light" onclick="changeTheme('light')">
                    <div class="theme-preview light-theme">
                        <div class="preview-header"></div>
                        <div class="preview-body">
                            <div class="preview-line"></div>
                            <div class="preview-line short"></div>
                        </div>
                    </div>
                    <div class="theme-info">
                        <input type="radio" name="theme" value="light" id="theme-light" checked>
                        <label for="theme-light">â˜€ï¸ AÃ§Ä±k Tema</label>
                    </div>
                </div>

                <div class="theme-option" data-theme="material" onclick="changeTheme('material')">
                    <div class="theme-preview material-theme">
                        <div class="preview-header" style="background: #2196F3;"></div>
                        <div class="preview-body" style="background: #FAFAFA;">
                            <div class="preview-line" style="background: rgba(0,0,0,0.6);"></div>
                            <div class="preview-line short" style="background: rgba(0,0,0,0.4);"></div>
                        </div>
                    </div>
                    <div class="theme-info">
                        <input type="radio" name="theme" value="material" id="theme-material">
                        <label for="theme-material">ğŸ¨ Material Design</label>
                    </div>
                </div>

                <div class="theme-option" data-theme="dark" onclick="changeTheme('dark')">
                    <div class="theme-preview dark-theme">
                        <div class="preview-header"></div>
                        <div class="preview-body">
                            <div class="preview-line"></div>
                            <div class="preview-line short"></div>
                        </div>
                    </div>
                    <div class="theme-info">
                        <input type="radio" name="theme" value="dark" id="theme-dark">
                        <label for="theme-dark">ğŸŒ™ Koyu Tema</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Loading -->
<div id="loading" class="loading" style="display: none;">
    <div class="spinner"></div>
    <p>YÃ¼kleniyor...</p>
</div>

<!-- Notification -->
<div id="notification" class="notification"></div>

<!-- Scripts -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="/static/js/profile.js"></script>

<script>
    // YardÄ±mcÄ± fonksiyonlar
    async function fetchWithAuth(url, options = {}) {
        const token = localStorage.getItem('access_token');
        if (!token) {
            window.location.href = '/login.html';
            throw new Error('Token yok');
        }
        const headers = { 'Authorization': `Bearer ${token}`, ...options.headers };
        return fetch(url, { ...options, headers });
    }

    function showLoading(show) {
        const loading = document.getElementById('loading');
        if (loading) loading.style.display = show ? 'flex' : 'none';
    }

    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        notification.textContent = message;
        notification.style.display = 'block';
        notification.style.background = type === 'error' ? '#FED7D7' : type === 'success' ? '#C6F6D5' : '#EDF2F7';
        notification.style.color = type === 'error' ? '#742A2A' : type === 'success' ? '#22543D' : '#2D3748';
        setTimeout(() => { notification.style.display = 'none'; }, 3000);
    }

    function logout() {
        localStorage.removeItem('access_token');
        window.location.href = '/login.html';
    }

   // Sayfa yÃ¼klendiÄŸinde
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetchWithAuth(`${API_BASE}/api/auth/me`);
            if (response.ok) {
                const data = await response.json();
                document.getElementById('user-display-name').textContent = data.username;
            }
        } catch (error) {
            console.error('KullanÄ±cÄ± bilgisi alÄ±namadÄ±:', error);
        }

        loadProfileSettings();
    });
</script>

</body>
</html>
